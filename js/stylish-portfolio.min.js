!function(e){"use strict";function t(){e("html, body").animate({scrollTop:0},1e3,"easeInOutExpo")}e(".menu-toggle").click(function(t){t.preventDefault(),e("#sidebar-wrapper").toggleClass("active"),e(".menu-toggle > .fa-bars, .menu-toggle > .fa-times").toggleClass("fa-bars fa-times"),e(this).toggleClass("active")}),e('a.js-scroll-trigger[href*="#"]:not([href="#"])').click(function(){if(location.pathname.replace(/^\//,"")==this.pathname.replace(/^\//,"")&&location.hostname==this.hostname){var t=e(this.hash);if((t=t.length?t:e("[name="+this.hash.slice(1)+"]")).length)return e("html, body").animate({scrollTop:t.offset().top},1e3,"easeInOutExpo"),!1}}),e("#sidebar-wrapper .js-scroll-trigger").click(function(){e("#sidebar-wrapper").removeClass("active"),e(".menu-toggle").removeClass("active"),e(".menu-toggle > .fa-bars, .menu-toggle > .fa-times").toggleClass("fa-bars fa-times")}),e(document).scroll(function(){e(this).scrollTop()>100?e(".scroll-to-top").fadeIn():e(".scroll-to-top").fadeOut()});var a,o,n,r,s,i,l={};function p(t){console.log("onclick");var n,i,l=a.getLonLatFromViewPortPx(t.xy).transform("EPSG:3857","EPSG:4326"),p=new Tmap.Size(24,38),c=new Tmap.Pixel(-p.w/2,-p.h);r?s?d("출발지와 도착지가 이미 선택되었습니다. 새로 지정하시려면 초기화 버튼을 클릭해 주세요~!"):(n=new Tmap.Icon("http://tmapapis.sktelecom.com/upload/tmap/marker/pin_r_m_e.png",p,c),s=new Tmap.Marker(l.transform("EPSG:4326","EPSG:3857"),n),o.addMarker(s),d("도착지가 선택되었습니다."),window.end_position=l,i=e("#search"),e("html, body").animate({scrollTop:i.offset().top},1e3,"easeInOutExpo")):(n=new Tmap.Icon("http://tmapapis.sktelecom.com/upload/tmap/marker/pin_r_m_s.png",p,c),r=new Tmap.Marker(l.transform("EPSG:4326","EPSG:3857"),n),o.addMarker(r),window.start_position=l,d("출발지가 선택되었습니다."))}function d(e){document.getElementById("result_box").innerHTML=e}l.appKey="2742f43e-b608-47b7-aa94-a951253c81d0",window.start_position,window.end_position,(a=new Tmap.Map({div:"tmap",width:"100%",height:"100%"})).events.register("click",a,p),a.events.register("touchend",a,p),o=new Tmap.Layer.Markers,a.addLayer(o),n=new Tmap.Layer.Vector("route"),a.addLayer(n),e("#reset_btn").click(function(){o.removeMarker(r),r=null,window.start_position=null,o.removeMarker(s),s=null,window.end_position=null,n.removeAllFeatures(),d("초기화 되었습니다."),t()}),e("#find_btn").click(function(){r&&s?e.ajax({method:"POST",headers:l,url:"https://api2.sktelecom.com/tmap/routes?version=1&format=xml",async:!1,data:{startX:window.start_position.lon,startY:window.start_position.lat,endX:window.end_position.lon,endY:window.end_position.lat,reqCoordType:"EPSG3857",resCoordType:"EPSG3857",angle:"172",searchOption:0},success:function(t){if(t){i=t;var o=(new XMLSerializer).serializeToString(i),r=e.parseXML(o),s=e(r).find("Document"),l="총 거리 : "+(s[0].getElementsByTagName("tmap:totalDistance")[0].childNodes[0].nodeValue/1e3).toFixed(1)+"km \n",p=" 총 시간 : "+(s[0].getElementsByTagName("tmap:totalTime")[0].childNodes[0].nodeValue/60).toFixed(0)+"분 \n ",c=" 총 요금 : "+s[0].getElementsByTagName("tmap:totalFare")[0].childNodes[0].nodeValue+"원 \n",m=" 예상 택시 요금 : "+s[0].getElementsByTagName("tmap:taxiFare")[0].childNodes[0].nodeValue+"원 ";e("#result_box").text(l+p+c+m),i=new Tmap.Format.KML({extractStyles:!0,extractAttributes:!0}).read(i),n.removeAllFeatures(),n.events.register("beforefeatureadded",n,function(e){var t={};switch(e.feature.attributes.styleUrl){case"#pointStyle":t.externalGraphic="http://topopen.tmap.co.kr/imgs/point.png",t.graphicHeight=16,t.graphicOpacity=1,t.graphicWidth=16;break;default:t.strokeColor="#ff0000",t.strokeOpacity="1",t.strokeWidth="5"}e.feature.style=t}),n.addFeatures(i),a.zoomToExtent(n.getDataExtent())}else d("길찾기 검색을 실패하였습니다.")},error:function(e,t,a){console.log("code:"+e.status+"\nmessage:"+e.responseText+"\nerror:"+a)}}):d("출발지를 선택해주세요!")}),e("#start_address_search_btn").click(function(){if(window.start_position)alert("출발지가 이미 선택되었습니다. 새로 지정하시려면 초기화 버튼을 클릭해 주세요~!");else{var n=[];n.push(e("#start_address_input1").val()),n.push(e("#start_address_input2").val()),n.push(e("#start_address_input3").val()),n.push(e("#start_address_input4").val());for(var s="",i=0;i<n.length;i++)n[i]&&(s+=n[i],s+=" ");if(s){console.log(s);var p={version:"1",fullAddr:s,appKey:l.appKey};e.get("https://api2.sktelecom.com/tmap/geo/fullAddrGeo",p,function(e){if(e){if(e.error)return void alert("주소 검색을 실패하였습니다. 주소를 다시 입력해주세요!");var n=e.coordinateInfo.coordinate[0].lon,s=e.coordinateInfo.coordinate[0].lat,i=new Tmap.LonLat(n,s).transform("EPSG:4326","EPSG:3857"),l=new Tmap.Size(24,38),p=new Tmap.Pixel(-l.w/2,-l.h),c=new Tmap.Icon("http://tmapapis.sktelecom.com/upload/tmap/marker/pin_r_m_s.png",l,p);r=new Tmap.Marker(i,c),o.addMarker(r),window.start_position=i,d("출발지가 선택되었습니다."),a.setCenter(i,16),t()}})}else alert("출발지 주소를 입력해주세요!")}}),e("#end_address_search_btn").click(function(){if(window.end_position)alert("도착지가 이미 선택되었습니다. 새로 지정하시려면 초기화 버튼을 클릭해 주세요~!");else{var n=[];n.push(e("#end_address_input1").val()),n.push(e("#end_address_input2").val()),n.push(e("#end_address_input3").val()),n.push(e("#end_address_input4").val());for(var r="",i=0;i<n.length;i++)n[i]&&(r+=n[i],r+=" ");if(r){console.log(r);var p={version:"1",fullAddr:r,appKey:l.appKey};e.get("https://api2.sktelecom.com/tmap/geo/fullAddrGeo",p,function(e){if(e){if(e.error)return void alert("주소 검색을 실패하였습니다. 주소를 다시 입력해주세요!");var n=e.coordinateInfo.coordinate[0].lon,r=e.coordinateInfo.coordinate[0].lat,i=new Tmap.LonLat(n,r).transform("EPSG:4326","EPSG:3857"),l=new Tmap.Size(24,38),p=new Tmap.Pixel(-l.w/2,-l.h),c=new Tmap.Icon("http://tmapapis.sktelecom.com/upload/tmap/marker/pin_r_m_e.png",l,p);s=new Tmap.Marker(i,c),o.addMarker(s),window.end_position=i,d("도착지가 선택되었습니다."),a.setCenter(i,16),t()}})}else alert("출발지 주소를 입력해주세요!")}})}(jQuery);