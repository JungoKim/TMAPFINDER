!function(e){"use strict";e(".menu-toggle").click(function(t){t.preventDefault(),e("#sidebar-wrapper").toggleClass("active"),e(".menu-toggle > .fa-bars, .menu-toggle > .fa-times").toggleClass("fa-bars fa-times"),e(this).toggleClass("active")}),e('a.js-scroll-trigger[href*="#"]:not([href="#"])').click(function(){if(location.pathname.replace(/^\//,"")==this.pathname.replace(/^\//,"")&&location.hostname==this.hostname){var t=e(this.hash);if((t=t.length?t:e("[name="+this.hash.slice(1)+"]")).length)return e("html, body").animate({scrollTop:t.offset().top},1e3,"easeInOutExpo"),!1}}),e("#sidebar-wrapper .js-scroll-trigger").click(function(){e("#sidebar-wrapper").removeClass("active"),e(".menu-toggle").removeClass("active"),e(".menu-toggle > .fa-bars, .menu-toggle > .fa-times").toggleClass("fa-bars fa-times")}),e(document).scroll(function(){e(this).scrollTop()>100?e(".scroll-to-top").fadeIn():e(".scroll-to-top").fadeOut()});var t,a,o,n,r,s,i={};function l(e){console.log("onclick");var o,s=t.getLonLatFromViewPortPx(e.xy).transform("EPSG:3857","EPSG:4326"),i=new Tmap.Size(24,38),l=new Tmap.Pixel(-i.w/2,-i.h);n?r?c("출발지와 도착지가 이미 선택되었습니다. 새로 지정하시려면 초기화 버튼을 클릭해 주세요~!"):(o=new Tmap.Icon("http://tmapapis.sktelecom.com/upload/tmap/marker/pin_r_m_e.png",i,l),r=new Tmap.Marker(s.transform("EPSG:4326","EPSG:3857"),o),a.addMarker(r),c("도착지가 선택되었습니다."),window.end_position=s):(o=new Tmap.Icon("http://tmapapis.sktelecom.com/upload/tmap/marker/pin_r_m_s.png",i,l),n=new Tmap.Marker(s.transform("EPSG:4326","EPSG:3857"),o),a.addMarker(n),window.start_position=s,c("출발지가 선택되었습니다."))}function c(e){document.getElementById("result_box").innerHTML=e}i.appKey="2742f43e-b608-47b7-aa94-a951253c81d0",window.start_position,window.end_position,(t=new Tmap.Map({div:"tmap",width:"100%",height:"100%"})).events.register("click",t,l),a=new Tmap.Layer.Markers,t.addLayer(a),o=new Tmap.Layer.Vector("route"),t.addLayer(o),e("#reset_btn").click(function(){a.removeMarker(n),n=null,window.start_position=null,a.removeMarker(r),r=null,window.end_position=null,o.removeAllFeatures(),c("초기화 되었습니다.")}),e("#find_btn").click(function(){console.log("click"),n&&r?e.ajax({method:"POST",headers:i,url:"https://api2.sktelecom.com/tmap/routes?version=1&format=xml",async:!1,data:{startX:window.start_position.lon,startY:window.start_position.lat,endX:window.end_position.lon,endY:window.end_position.lat,reqCoordType:"EPSG3857",resCoordType:"EPSG3857",angle:"172",searchOption:0},success:function(a){if(a){s=a;var n=(new XMLSerializer).serializeToString(s),r=e.parseXML(n),i=e(r).find("Document"),l="총 거리 : "+(i[0].getElementsByTagName("tmap:totalDistance")[0].childNodes[0].nodeValue/1e3).toFixed(1)+"km \n",p=" 총 시간 : "+(i[0].getElementsByTagName("tmap:totalTime")[0].childNodes[0].nodeValue/60).toFixed(0)+"분 \n ",m=" 총 요금 : "+i[0].getElementsByTagName("tmap:totalFare")[0].childNodes[0].nodeValue+"원 \n",d=" 예상 택시 요금 : "+i[0].getElementsByTagName("tmap:taxiFare")[0].childNodes[0].nodeValue+"원 ";e("#result_box").text(l+p+m+d),s=new Tmap.Format.KML({extractStyles:!0,extractAttributes:!0}).read(s),o.removeAllFeatures(),o.events.register("beforefeatureadded",o,function(e){var t={};switch(e.feature.attributes.styleUrl){case"#pointStyle":t.externalGraphic="http://topopen.tmap.co.kr/imgs/point.png",t.graphicHeight=16,t.graphicOpacity=1,t.graphicWidth=16;break;default:t.strokeColor="#ff0000",t.strokeOpacity="1",t.strokeWidth="5"}e.feature.style=t}),o.addFeatures(s),t.zoomToExtent(o.getDataExtent())}else c("길찾기 검색을 실패하였습니다.")},error:function(e,t,a){console.log("code:"+e.status+"\nmessage:"+e.responseText+"\nerror:"+a)}}):c("출발지를 선택해주세요!")})}(jQuery);